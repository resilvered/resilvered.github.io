---
title: "Solaris 11 Express upgrade to Solaris 11/11"
layout: "post"
permalink: "/2012/03/solaris-11-express-upgrade-to-solaris.html"
uuid: "378033436925093228"
guid: "tag:blogger.com,1999:blog-8745734052417186264.post-378033436925093228"
date: "2012-03-31 12:49:00"
updated: "2012-03-31 12:52:01"
description: 
blogger:
    siteid: "8745734052417186264"
    postid: "378033436925093228"
    comments: "0"
categories: [blog, sun, Solaris 11, oracle]
tags: [sun, Solaris 11, oracle]
author: 
    name: "Alan Chalmers"
    url: "https://plus.google.com/109008868852571463084?rel=author"
    image: "//lh6.googleusercontent.com/-vRVdiWd12ak/AAAAAAAAAAI/AAAAAAAAHKc/wXgK4dFefp8/s512-c/photo.jpg"
---

<div class="css-full-post-content js-full-post-content">
Solaris 11/11 has been out for some time I've been slow to move. Mostly the Solaris 11 express I run know works well and fits my needs so I have not need to upgrade. However I'm working on some side project and some software is going to need complied, that and I figured I need to keep my hand in so best move up to the current release.<br /><br />So should be pretty straight forward:<br /><pre># mount neo:/ISO /mnt<br /># lofiadm -a /ISO/Oracle/sol-11-1111-repo-full.iso <br /># mount -F hsfs /dev/lofi/1 /mnt2<br /># pkg set-publisher -G http://192.168.0.31/ -g file:///mnt2/repo solaris<br /># pkg update --accept --be-name Solaris_11_11<br /></pre>Don't forget to tiddy up: <br /><pre>umount /mnt2<br /># lofiadm -d /ISO/Oracle/sol-11-1111-repo-full.iso <br /># umount /mnt</pre> Check my new BE is there and restart: <pre># beadm list<br /># init 6</pre> Quick look on the console as is starting up some SMF upgrade messages, no errors messages so we might have success. VNC is still working , so all look ok. Zpool needs upgrading but I might hold off on the for now just in case I need to move back. Hmm small issue zone boot layout needs to be converted and it's a one way deal. I only have one zone I want to keep here and thats the one the servers my repo.<br /><br />Ok bite the bullet just convert it:<br /><pre><br /># /usr/lib/brand/shared/dsconvert jones<br />jones: Creating zone rpool dataset<br />jones: Creating zone export dataset<br />jones: Creating zone export/home dataset<br />jones: Creating zone ROOT dataset<br />jones: Cloning datasets from ROOT to rpool/ROOT<br />jones: Remounting zone at /zones/jones/root<br /><br />  NOTICE: zone jones needs to be updated with attach -u<br />     Run: "zoneadm -z jones detach" to detach, then<br />     Run: "zoneadm -z jones attach -u" to attach.<br /><br />jones: Removing obsolete datasets<br />promoting 'rpool/zones/jones/rpool/ROOT/zbe-4'.<br />promoting 'rpool/zones/jones/rpool/ROOT/zbe-3'.<br />promoting 'rpool/zones/jones/rpool/ROOT/zbe-2'.<br />promoting 'rpool/zones/jones/rpool/ROOT/zbe-1'.<br />promoting 'rpool/zones/jones/rpool/ROOT/zbe'.<br />jones: Converting dataset aliases<br /><br />jones: Verifying zone with zoneadm<br /><br />jones: Checking for potential configuration conflicts<br /><br />jones: Conversion complete<br /></pre> And that's where things start to go pair shaped. Attached failed... ah yep I recall this from the last time need to remount the local file repo. In hind sight if would seem now silly to have the repo in a zone. I read during my last 11 express SRU update that the pkg repp server needs to be at the same OS version as the package it was servering, so I go through this strange update process of updating the global from a file repo and then needing to update the zone via detach attach process ... kind of makes it pointless to have a repo.<br /><br />Anyway proceed and reattach: <br /> <pre><br />mount /mnt/Oracle/sol-11-1111-repo-full.iso /mnt2<br />mount -F hsfs /mnt/Oracle/sol-11-1111-repo-full.iso /mnt2<br />zoneadm -z jones attach -u<br /></pre> Failed again ... check the log something about system publisher in maintenance ok clear that  <pre>svcadm clear svc:/application/pkg/system-repository</pre> Ok try again, failed hmm Image format already up to date  <pre><br />Image format already current.<br />ERROR: Updating image format failed<br /></pre> ... ok lets just attach then  <pre><br />Updating image format<br />ERROR: Updating image format failed<br />                    Result: Attach Failed.<br /></pre>... Oh please give me strength, already updated, then failed to update got to love the error messages. At this point I'm thinking ok it's just my repo I could just scrape it. Still should fix it, best take a look in the log file.  <pre><br />Updating image format<br />pkg: 0/1 catalogs successfully updated:<br />   <br />Framework error: code: 7 reason: Failed connect to localhost:80; Connection refused<br />URL: 'http://localhost/versions/0/'.<br /></pre> Hmm the zone is using it's own pkg repo to update which is of course it's self since the zone is my repo server.<br /><br />Ok so here is the problem:<br /> <pre># pkg -R /zones/jones/root publisher                               <br />PUBLISHER                             TYPE     STATUS   URI<br />solaris                  (syspub)     origin   online   http://localhost/<br />solaris                  (syspub)     origin   online   http://localhost:1008/solaris/79680b7ee82a9c8eeb3e86d7e17dfabb67cf0cfe/<br /></pre> After much messing around and reading the man page to understand the nuances of setting and unsetting publisher, especial system ones, I eventual figure out out to remove the offending publisher  <pre><br />pkg -R /zones/jones/root set-publisher -G http://localhost/ solaris<br /></pre> Bingo Update on attach now works.
</div>
