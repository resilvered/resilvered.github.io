---
title: "Linux kickstart for Solaris Admin's"
layout: "post"
permalink: "/2011/11/linux-kickstart-for-solaris-admins-so.html"
uuid: "7103889489134987021"
guid: "tag:blogger.com,1999:blog-8745734052417186264.post-7103889489134987021"
date: "2011-11-07 13:38:00"
updated: "2011-11-22 09:16:04"
description: 
blogger:
    siteid: "8745734052417186264"
    postid: "7103889489134987021"
    comments: "0"
categories: [blog, kickstart, MSOSUG, Linux, work, virtualbox, solaris, oracle]
tags: [kickstart, MSOSUG, Linux, work, virtualbox, solaris, oracle]
author: 
    name: "Alan Chalmers"
    url: "https://plus.google.com/109008868852571463084?rel=author"
    image: "//lh6.googleusercontent.com/-vRVdiWd12ak/AAAAAAAAAAI/AAAAAAAAHKc/wXgK4dFefp8/s512-c/photo.jpg"
---

<div class="css-full-post-content js-full-post-content">
<h1>                                             Linux kickstart for Solaris Admin's</h1>So sometimes Solaris Admins need to turn their hand at another OS for various reasons, especial in this day and age of mass production of virtual environments. Solaris Admins will be well versed with jumpstart a tried and&nbsp;truly&nbsp;tested system of automated builds for &nbsp;over a decade now. While recently&nbsp;this system has been&nbsp;thrown&nbsp;out with the bath water for AI in Solaris 11 and while the jury is still out on that one that's a conversation for another time.<br /><br />So Kickstart, most of you are think Commodore Amiga right, well there is a less known kickstart for Linux or should I say Redhat Enterprise Linux RHEL and Redhat derived/like systems , CentOS, OEL, and SL, that as the name sugests performs the&nbsp;equivalent&nbsp;task for RHEL as Jumpstart does for Solaris.<br /><br />I'm not going to get into the deep and dirty of Kickstart and how that work but rather provide a quick and dirty so the Solaris folk can easily find there way. For what ever reason you find&nbsp;yourself&nbsp;in this postion it's at the very least always handy to know what the young kids are up to.<br /><br />So lets look at what I'm working with:<br /><ul><li>Kickstart Server built with OEL 6.1 on VirtualBox 4.1.6</li><ul><li>1GB RAM built from DVD as Software Development&nbsp;Workstation option</li><li>Configured&nbsp;with Oracle public yum repo</li><li>2 NICs</li><ul><li>eth0&nbsp;bridged&nbsp;to my LAN DHCP configured</li><li>eth1 internal VirtualBox network&nbsp;statically&nbsp;allocated 10.0.2.254</li></ul><li>/data filesystem with copies of DVD install images</li><ul></ul></ul><li>Kickstart test client</li><ul><li>1 NIC</li><ul><li>eth0&nbsp;&nbsp;internal VirtualBox network</li></ul></ul></ul>To anser the obvious question is why OEL, well couple of reason's, readily&nbsp;accessible&nbsp;to download and I'm actual giving a talk on the at MSOSUG and Oracle is providing faciliteis and refreshments so I it only seemed fair.<br /><br />If you have the setup the same as mine then you should be able to use the scripts I have written to setup your kickstart server and be in business in next to know time. If you just want script without the story then head straight&nbsp;to the end for the download.<br /><h2>                      Prerequisite&nbsp;software</h2>I have&nbsp;chosen&nbsp;to do my kickstart via http but I could have used NFS or DVD , but again not an&nbsp;lesson&nbsp;in Kickstart just to get you moving quickly.<br /><ul><li>httpd - already installed</li><li>xinetd - needed for tftpd</li><li>tftpd&nbsp;</li><li>syslinux - for the pxe boot files</li><li>dhcpd</li><li>Some DVD images of a RHEL derivative&nbsp;Linux</li></ul><pre>yum -y install dhcp xinetd tftp-server syslinux</pre><h2>                      Setup httpd</h2>So with that out of the way lets configure the web server /etc/httpd/conf.d/welcome.conf comment out everything to allow us to get index of the pages then start it up <br /><br /><pre>sed -i 's/^[&lt; ]/#/' /etc/httpd/conf.d/welcome.conf<br />chkconfig httpd on<br />service httpd start</pre><br />I have a /data directory where I have a local copy of the install media. So Create some symlinks in to my web server so I can make the install media&nbsp;available.<br /><br /><pre>for distro in `ls /data | grep -v lost`<br />do <br />ln -s /data/$distro /var/www/html/$distro<br />chcon -R -t httpd_sys_content_t /data/$distro/<br />done<br /></pre><h2>                                            Setup dhcpd</h2>Next we need to setup dhcp server. Now for you Solaris folk it's the ISC dhcp server so those of you that struggled with the Solaris dhcp, it never really bothered me, you will have no problems configuring this one. You can grab my pre-caned basic dhcpd.conf to get you going. Turn it on and start it up<br /><br /><pre>wget http://dl.dropbox.com/u/2236361/kick/dhcpd.conf -O /etc/dhcp/dhcpd.conf<br />chkconfig dhcpd on<br />service dhcpd start</pre><h2>                                      Setup tftpd</h2>Trival ftp , ok pretty straight forward two minor gotchas. The linux default tftpboot directory is /var/lib/tftptboot now being a Solaris person I though no problems just change it to /tftpboot which I did but to to make that work with selinux , which by default is on on my build and I didn't really want to change, I needed to learn about chcon, which I did. In the end I though well is meant to be a basic exercise in geeting this up and running so perhaps just leave it all where it is, works nicely and less hassle. If you need the sym link /tftpboot<br /><br /><pre>chkconfig tftp on<br />chkconfig xinetd on<br />service xinetd restart</pre><br />The second "gotcha" iptables, again on by default on my build rather than just trun it off add port 69 and you are in business. The Syntax for iptables has changed between what is supplied with 6.x as to that of 5.x so just be aware if you have and older build. While im here add in the httpd server also.<br /><br /><pre>iptables -D INPUT -j REJECT --reject-with icmp-host-prohibited<br />iptables -A INPUT -p udp -m udp --dport 69 -j ACCEPT<br />iptables -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT<br />iptables -A INPUT -p tcp -m tcp --dport 443 -j ACCEPT<br />iptables -A INPUT -j REJECT --reject-with icmp-host-prohibited<br />service iptables save<br />service iptables restart</pre><h2>                          PXE boot files</h2>Ah yes I aways seem to get this wrong with Solaris for X86 , maybe is was just messing around with dhcp macros. Anyway a couple of files that are needed, make sure you have installed the syslinux package,&nbsp;you will also need to setup kernel and&nbsp;initial&nbsp;Ram disk pxe files. Now you can't install a 6.x OS from a 5.x pxeboot and vice versa so you need to make sure you have the right files from the right distro. I'm running a couple of different installs from my kickstart server so I have a simple shell loop to take care of&nbsp;setting&nbsp;that up for me.<br /><br /><pre>mkdir -p /var/lib/tftpboot/pxelinux.cfg<br />cp -p /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot<br />cp -p /usr/share/syslinux/menu.c32 /var/lib/tftpboot<br /><br />for distro in `ls /data | grep -v lost`<br />do<br />mkdir -p /var/lib/tftpboot/$distro<br />cp -p /var/www/html/$distro/images/pxeboot/initrd.img /var/lib/tftpboot/$distro/<br />cp -p /var/www/html/$distro/images/pxeboot/vmlinuz /var/lib/tftpboot/$distro/<br />done</pre><br />For the last part just&nbsp;prepare&nbsp;your pxelinux config file or what is the&nbsp;essentially the&nbsp;boot menu <br /><br /><pre>cat &gt; /var/lib/tftpboot/pxelinux.cfg/default&lt;&lt;EOF<br />default menu.c32<br />MENU TITLE Linux Kickstart<br />label oel57boot<br /> MENU LABEL Install OEL 5.7 from http://10.0.2.254/oel57.cfg <br /> kernel oel5.7/vmlinuz<br /> append initrd=oel5.7/initrd.img ks=http://10.0.2.254/oel57.cfg ksdevice=eth0<br />label oel61boot<br /> MENU LABEL Install OEL 6.1 from http://10.0.2.254/oel61.cfg <br /> kernel oel6.1/vmlinuz<br /> append initrd=oel6.1/initrd.img ks=http://10.0.2.254/oel61.cfg ksdevice=eth0<br />PROMPT 0<br />TIMEOUT 0<br />EOF</pre>or just grab my pre-canned one with a few bits setup on it.  <br /><br /><pre>wget http://dl.dropbox.com/u/2236361/kick/default -O /var/lib/tftpboot/pxelinux.cfg/default</pre><div></div><h2>                                    Kickstart files</h2><div>So this is weather this action is right... well yeah it's where you can make it all happen but like I said at the start this isn't about the in depths of kickstart but how to get you going so for sure use my pre-canned one that will get you runing.</div><pre>wget http://dl.dropbox.com/u/2236361/kick/oel57.cfg -O /var/www/html/oel55.cfg<br />wget http://dl.dropbox.com/u/2236361/kick/oel61.cfg -O /var/www/html/oel61.cfg<br /></pre><div><br />What you will get from my ks files is pretty minimal install, Australian local and Victorian timezone root password of root<br /><h2>                  The booting</h2>All the hard work now down it's just a matter of a simple LAN boot. So if you recall at the start my test client is a VirtualBox Guest with Nic&nbsp;connected to internal network. &nbsp;F12 for boot options and l for lan boot&nbsp;all&nbsp;proceeding&nbsp;will you will get the boot menu screen with options<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-TVowOuMkAiI/TsJe1Mtjh7I/AAAAAAAAAVI/c8RI10Mtdvs/s1600/Screen+Shot+2011-11-15+at+11.44.11+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="163" src="http://1.bp.blogspot.com/-TVowOuMkAiI/TsJe1Mtjh7I/AAAAAAAAAVI/c8RI10Mtdvs/s320/Screen+Shot+2011-11-15+at+11.44.11+PM.png" width="320" /></a></div><br /><h2>                  The Shortcut</h2>So I wrapped all this stuff up into one neat little package<a href="http://dl.dropbox.com/u/2236361/kick/setup-kickstart.sh"> setup-kickstart.sh</a> which will configure you a working kickstart server on the basis you have the setup I described at the start. You while also already need to have copied all the media to /data for obvious reason I can't distribute that.<br /><br /><pre>wget http://dl.dropbox.com/u/2236361/kick/setup-kickstart.sh<br />chmod +x setup-kickstart.sh<br />./setup-kickstart.sh</pre><br /></div>
</div>
